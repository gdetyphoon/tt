(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,706879,266373,144745,e=>{"use strict";var t=e.i(585654),a=e.i(262787),r=e.i(900085),s=e.i(815698),i=e.i(350461);let n={NODE_ENV:"production",HOST:i.default.env.HOST,DEBUG:i.default.env.DEBUG,ANALYZE:i.default.env.ANALYZE,LOCAL_API_ORIGIN:i.default.env.NEXT_LOCAL_API_ORIGIN,STEAM_LOCAL_API_ORIGIN:i.default.env.NEXT_STEAM_LOCAL_API_ORIGIN,RUNTIME_ENV:"production",BUILD_MODE:"export",API_PROTO:"https",API_HOST:"playerok.com",API_URI:"/graphql",API_ADMIN_URI:"https://playerok.com/rest-api/admin",STEAM_API_PROTO:"https",STEAM_API_HOST:"steam.playerok.com",REST_API_URL:i.default.env.NEXT_PUBLIC_REST_API_URL,REST_API_ADMIN_HOST:i.default.env.NEXT_PUBLIC_REST_API_ADMIN_HOST,SUBSCRIPTIONS_URI:"/subscriptions",GA_ID:"G-JVXCH40TY4",VAPID_KEY:"BOdhcsYETOxOg9waXM_XhfFfKeinmTxKpWN4r3DBS8JKZqorBFNxzEzI5MtjGE_XgkjNo2xcVCjdrZJtH4DksLo",SENTRY_DSN:"https://a4969afce5823d108f2776ec83d4f1d1@s.checktrustservice.com/3",SENTRY_DRY_RUN:"on",SENTRY_ORG:"playerok",SENTRY_PROJECT:"main-web",SENTRY_URL:i.default.env.NEXT_SENTRY_URL,SHARP_PATH:i.default.env.NEXT_SHARP_PATH,GTM_ID:""},o=(0,t.object)({NODE_ENV:(0,s.nodeEnvSchema)(),HOST:(0,s.serverExact)((0,t.string)()),DEBUG:(0,t.pipe)((0,t.optional)((0,t.string)()),(0,t.transform)(r.booleanEnvTransform)),ANALYZE:(0,t.pipe)((0,t.optional)((0,t.string)()),(0,t.transform)(r.booleanEnvTransform)),LOCAL_API_ORIGIN:(0,s.serverExact)((0,t.pipe)((0,t.string)(),(0,t.url)())),STEAM_LOCAL_API_ORIGIN:(0,s.serverExact)((0,t.pipe)((0,t.string)(),(0,t.url)())),SENTRY_URL:(0,s.serverExact)((0,t.pipe)((0,t.string)(),(0,t.url)())),SHARP_PATH:(0,s.serverExact)((0,t.string)())}),u=(0,t.object)({RUNTIME_ENV:(0,s.nodeEnvSchema)(),BUILD_MODE:(0,t.optional)((0,t.pipe)((0,t.string)(),(0,t.picklist)(["export"]))),API_PROTO:(0,t.string)(),API_HOST:(0,t.string)(),API_URI:(0,t.string)(),STEAM_API_PROTO:(0,t.string)(),STEAM_API_HOST:(0,t.string)(),API_ADMIN_URI:(0,t.string)(),SUBSCRIPTIONS_URI:(0,t.string)(),GA_ID:(0,t.string)(),VAPID_KEY:(0,t.string)(),SENTRY_DSN:(0,t.pipe)((0,t.string)(),(0,t.url)()),SENTRY_DRY_RUN:(0,t.pipe)((0,t.string)(),(0,t.picklist)(["on","off"])),SENTRY_ORG:(0,t.string)(),SENTRY_PROJECT:(0,t.string)(),GTM_ID:(0,t.optional)((0,t.string)())}),l=(0,t.object)({...o.entries,...u.entries}),c=(0,a.parseEnv)(l,n).API_ADMIN_URI;e.s(["ADMIN_API_BASE_URL",0,c],706879);var p=e.i(114907);let d=async e=>{try{return await e.clone().json()}catch{try{let t={};return(await e.clone().formData()).forEach((e,a)=>{t[a]=e}),t}catch{return{}}}};e.s(["extractBody",0,d],266373);var m=e.i(26114);let y=async(e,t)=>t.query({query:m.ViewerDocument,variables:(0,p.parseVariables)(e),errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!1}}).then(e=>{if(e?.errors||!e?.data?.viewer)throw(0,p.createError)("Get viewer failed");let{id:t,username:a,role:r,profile:s}=e.data.viewer;return{id:t,username:a,role:r,profile:{id:s.id,avatarURL:s.avatarURL}}}),g=async(e,t)=>{let{avatar:a,...r}=await d(e);return t.mutate({mutation:m.UpdateViewerProfileDocument,variables:{input:r,avatar:a},errorPolicy:"all",fetchPolicy:"network-only"}).then(e=>{if(!e?.data?.updateViewerProfile)throw(0,p.createError)("Patch viewer failed");let{id:t,avatarURL:a}=e.data.updateViewerProfile;return{id:t,avatarURL:a}}).catch(e=>{throw(0,p.createError)("Patch viewer failed",e)})};e.s(["getViewer",0,y,"patchViewer",0,g],144745)},486366,e=>{"use strict";var t,a,r,s,i,n,o,u,l,c,p,d=((t={}).Accountant="ACCOUNTANT",t.Admin="ADMIN",t.AdvDirector="ADV_DIRECTOR",t.AdvManager="ADV_MANAGER",t.Checker="CHECKER",t.Developer="DEVELOPER",t.GamesAndApps="GAMES_AND_APPS",t.Moderator="MODERATOR",t.Monitoring="MONITORING",t.OfficialSeller="OFFICIAL_SELLER",t.Postmoderator="POSTMODERATOR",t.Postsecurity="POSTSECURITY",t.Security="SECURITY",t.Support="SUPPORT",t.SystemSeller="SYSTEM_SELLER",t.User="USER",t),m=((a={}).approved="approved",a.rejected="rejected",a.removed="removed",a.pendingApproval="pendingApproval",a),y=((r={}).ASC="ASC",r.DESC="DESC",r),g=((s={}).Regular="REGULAR",s.Premium="PREMIUM",s),P=((i={}).FirstTime="FIRST_TIME",i.AfterEdit="AFTER_EDIT",i),f=((n={}).Approved="APPROVED",n.Blocked="BLOCKED",n.Declined="DECLINED",n.Discontinued="DISCONTINUED",n.Draft="DRAFT",n.Expired="EXPIRED",n.PendingApproval="PENDING_APPROVAL",n.PendingModeration="PENDING_MODERATION",n.PendingStatusPayment="PENDING_STATUS_PAYMENT",n.Removed="REMOVED",n.Sold="SOLD",n),v=((o={}).Application="APPLICATION",o.Game="GAME",o.MobileGame="MOBILE_GAME",o),S=((u={}).Custom="CUSTOM",u.Default="DEFAULT",u.Premium="PREMIUM",u.Vip="VIP",u),h=((l={}).ItemPaid="ITEM_PAID",l.OfficialItemPaid="OFFICIAL_ITEM_PAID",l.ItemSent="ITEM_SENT",l.DealConfirmed="DEAL_CONFIRMED",l.DealConfirmedAfterProblem="DEAL_CONFIRMED_AFTER_PROBLEM",l.DealRolledBack="DEAL_ROLLED_BACK",l.ProblemReported="DEAL_HAS_PROBLEM",l.ProblemResolved="DEAL_PROBLEM_RESOLVED",l.ItemSentAutomatically="ITEM_SENT_AUTOMATICALLY",l.DealConfirmedAutomatically="DEAL_CONFIRMED_AUTOMATICALLY",l),C=((c={}).SupportChats="SUPPORT_CHATS",c.VipSupportChats="VIP_SUPPORT_CHATS",c.SuspiciousChats="SUSPICIOUS_CHATS",c.ModerationItems="MODERATION_ITEMS",c.ProblemDealChats="PROBLEM_DEAL_DEALS",c.ModerationTestimonials="MODERATION_TESTIMONIALS",c.Payouts="PAYOUTS",c.Payments="PAYMENTS",c.SuspiciousSellers="SUSPICIOUS_SELLERS",c.GameProposals="GAME_PROPOSALS",c),T=((p={}).Suspicious="SUSPICIOUS",p.Verified="VERIFIED",p.NotSuspicious="NOT_SUSPICIOUS",p);e.s(["DealEvent",()=>h,"GameType",()=>v,"ItemPriority",()=>S,"ItemStatus",()=>f,"ListingSubmissionType",()=>P,"ListingTier",()=>g,"PayoutSuspiciousStatus",()=>T,"RequestType",()=>C,"SortDirection",()=>y,"TestimonialStatus",()=>m,"UserRole",()=>d])},614266,e=>{"use strict";var t=e.i(391398),a=e.i(703599),r=e.i(477834),s=e.i(430446),i=e.i(766362),n=e.i(706879),o=e.i(144745),u=e.i(114907),l=e.i(26114),c=e.i(486366);let p=e=>{if(e)return e===c.ListingTier.Premium?c.ItemPriority.Premium:c.ItemPriority.Custom},d=e=>{if(e)return e!==c.ListingSubmissionType.FirstTime},m=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.AdminItemsDocument,variables:{filter:{categoryIds:a?.categories,games:a?.games,approvedTestimonialsCounter:a?.testimonials,itemWasChanged:d(a?.listingSubmissionType),priority:p(a?.listingTier),status:[c.ItemStatus.PendingApproval,c.ItemStatus.PendingModeration],autoModerationMode:!1},pagination:a?.pagination,sort:a?.sort},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!1}}),s=r?.data?.items;return{items:s?.edges.map(({node:e})=>({id:String(e.id),slug:e.slug,status:e.status,name:e.name,price:e.price,rawPrice:e.rawPrice,feeMultiplier:e.feeMultiplier,game:{id:e.game.id,name:e.game.name,type:e.game.type,slug:e.game.slug,logoUrl:e.game.logo?.url},gameCategory:{id:String(e.category?.id),name:e.category.name,slug:e.category.slug},attachmentUrl:e.attachment?.url,user:{id:String(e.user.id),testimonialCounter:e.user.testimonialCounter,rating:e.user.rating},priority:e.priority,statusExpirationDate:e.statusExpirationDate??null}))??[],pageInfo:{startCursor:s?.pageInfo.startCursor??null,endCursor:s?.pageInfo.endCursor??null,hasPreviousPage:!!s?.pageInfo.hasPreviousPage,hasNextPage:!!s?.pageInfo.hasNextPage},totalCount:Number(s?.totalCount??0)}},y=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.CountItemsDocument,variables:{filter:{categoryIds:a?.categories,games:a?.games,approvedTestimonialsCounter:a?.testimonials,itemWasChanged:d(a?.listingSubmissionType),priority:p(a?.listingTier),status:[c.ItemStatus.PendingApproval,c.ItemStatus.PendingModeration],autoModerationMode:!1}}});return{count:Number(r?.data?.countItems??0)}},g=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.GetAllGamesDocument,variables:{filter:{name:a?.search||void 0,type:a?.gameType},pagination:a?.pagination,sort:(e=>{if(e&&"moderationItemsCount"===e.field)return{field:"moderationRequestCount",direction:e.direction}})(a?.sort)},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),s=r?.data?.allGames;return{items:s?.edges.map(({node:e})=>({id:String(e.id),slug:e.slug,name:e.name,type:e.type,image:e.logo?.url,createdAt:e.createdAt,categories:e.categories?.map(e=>({id:e.id,name:e.name,slug:e.slug}))??[]}))??[],pageInfo:{startCursor:s?.pageInfo.startCursor??null,endCursor:s?.pageInfo.endCursor??null,hasPreviousPage:!!s?.pageInfo.hasPreviousPage,hasNextPage:!!s?.pageInfo.hasNextPage},totalCount:Number(s?.totalCount??0)}},P=async(e,t)=>{let a=Object.values(l.GameTypeId);return(await Promise.all(a.map(e=>t.query({query:l.GetCountAdminGamesDocument,variables:{filter:{type:e}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}})))).map((e,t)=>({gameType:a[t],count:e?.data?.adminCountGames}))};var f=e.i(266373);let v=e=>({[l.TestimonialStatus.Approved]:c.TestimonialStatus.approved,[l.TestimonialStatus.Rejected]:c.TestimonialStatus.rejected,[l.TestimonialStatus.Removed]:c.TestimonialStatus.removed,[l.TestimonialStatus.PendingApproval]:c.TestimonialStatus.pendingApproval})[e],S=e=>({[c.TestimonialStatus.approved]:l.TestimonialStatus.Approved,[c.TestimonialStatus.rejected]:l.TestimonialStatus.Rejected,[c.TestimonialStatus.removed]:l.TestimonialStatus.Removed,[c.TestimonialStatus.pendingApproval]:l.TestimonialStatus.PendingApproval})[e],h=async(e,t,a)=>{let{status:r}=await (0,f.extractBody)(e),s=S(r);return t.mutate({mutation:l.UpdateTestimonialDocument,variables:{input:{id:a?.id,status:s}}}).then(e=>{if(e?.errors||!e?.data?.updateTestimonial)throw(0,u.createError)("Update testimonial status failed");let t=e.data.updateTestimonial,{deal:a,user:r}=t,s=a.item;return{id:String(t.id),username:r.username||"",userImageUrl:r.avatarURL||null,userRole:r.role,status:v(t.status),rating:Number(t.rating),reviewDate:String(t.createdAt),reviewText:t.text||"",item:{itemId:String(s.id),itemImageUrl:s.attachment?.url,itemTitle:s.name,price:Number(s.price),rawPrice:Number(s.rawPrice)}}}).catch(e=>{throw e})},C=async(e,t)=>{let a=(0,u.parseVariables)(e),r={first:a?.pagination?.first||10,after:a?.pagination?.after,before:a?.pagination?.before,last:a?.pagination?.last},s=a?.status,i=Array.isArray(s)?s:s?[s]:null,n=i?{status:i.map(S)}:{};return t.query({query:l.AdminTestimonialsDocument,variables:{pagination:r,filter:n},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!1}}).then(e=>{if(e?.errors||!e?.data?.testimonials)throw(0,u.createError)("Get testimonials failed");let{edges:t,totalCount:a,pageInfo:s}=e.data.testimonials;return{testimonials:t.map(e=>{let{node:t}=e,{deal:a,user:r}=t,s=a.item;return{id:String(t.id),username:r.username||"",userImageUrl:r.avatarURL||null,userRole:r.role,status:v(t.status),rating:Number(t.rating),reviewDate:String(t.createdAt),reviewText:t.text||"",item:{itemId:String(s.id),itemImageUrl:s.attachment?.url,itemTitle:s.name,price:Number(s.price),rawPrice:Number(s.rawPrice)}}}),metaData:{totalCount:a,limit:r.first||r.last||10,offset:0},pageInfo:{hasNextPage:s.hasNextPage,hasPreviousPage:s.hasPreviousPage,startCursor:s.startCursor,endCursor:s.endCursor}}}).catch(e=>{throw e})},T=async(e,t)=>{let a=await t.query({query:l.CountTestimonialsDocument,variables:{filter:{status:[l.TestimonialStatus.PendingApproval]}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!1}});return{count:Number(a?.data?.countTestimonials??0)}},I=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.CategoriesDocument,variables:{filter:{hasObtaining:a?.hasObtaining,hasCustomObtaining:a?.hasCustomObtaining,type:a?.categoryType},pagination:a?.pagination},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),s=r?.data?.categories;return{items:s?.edges.map(({node:e})=>({id:String(e.id),name:e.name}))??[],pageInfo:{startCursor:s?.pageInfo.startCursor??null,endCursor:s?.pageInfo.endCursor??null,hasPreviousPage:!!s?.pageInfo.hasPreviousPage,hasNextPage:!!s?.pageInfo.hasNextPage},totalCount:Number(s?.totalCount??0)}},A=[c.DealEvent.ItemPaid,c.DealEvent.OfficialItemPaid,c.DealEvent.ProblemReported,c.DealEvent.ProblemResolved,c.DealEvent.DealConfirmed,c.DealEvent.DealConfirmedAfterProblem],E=[c.DealEvent.ItemSent,c.DealEvent.DealRolledBack],R=e=>{let t,a=/{{(.+?)}}/g,r=[];for(;t=a.exec(e);)r.push(t[1]);return r[0]},O=e=>({id:e.id,username:e.username}),D=e=>"string"==typeof e?"true"===e:e,w=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.AdminSupportChatsDocument,variables:{pagination:a?.pagination,filter:{type:l.ChatType.Support,hasDealProblem:D(a?.dealHasProblem),hasFrozenBalance:!1,isVip:D(a?.ownerIsVip),status:[l.ChatStatus.New]}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),s=r?.data?.chats;return{items:s?.edges.map(({node:e})=>{let t,a,r;return t=e.lastMessage?(({deal:e,text:t,user:a})=>{if(!t||!e)return null;let r=R(t),s=null,i=null;return r===c.DealEvent.ItemPaid&&e.item.sellerType===l.ItemSellerType.System&&(r=c.DealEvent.OfficialItemPaid),A.includes(r)&&(s=a??e.user,i=e.item.user),E.includes(r)&&(s=a??e.item.user,i=e.user),{dealEvent:r,eventByUser:s?O(s):null,eventToUser:i?O(i):null}})(e.lastMessage):null,a=null,r=null,e.lastMessage?.event&&(a=e.lastMessage.eventByUser?{id:String(e.lastMessage.eventByUser.id),username:e.lastMessage.eventByUser.username}:null,r=e.lastMessage.eventToUser?{id:String(e.lastMessage.eventToUser.id),username:e.lastMessage.eventToUser.username}:null),t?.dealEvent&&(a=t.eventByUser,r=t.eventToUser),{id:String(e.id),lastMessage:{id:String(e.lastMessage?.id),text:e.lastMessage?.text??null,createdAt:e.lastMessage?.createdAt,event:e.lastMessage?.event??void 0,dealEvent:t?.dealEvent,eventByUser:a,eventToUser:r},unreadMessagesCount:e.unreadMessagesCounter,type:e.type,owner:{id:e.owner?.id,username:e.owner?.username,avatarUrl:e.owner?.avatarURL??null,isOnline:e.owner?.isOnline,isVip:e.owner?.isVip,isBlocked:e.owner?.isBlocked,isOfficial:e.owner?.role===l.UserRole.OfficialSeller}}})??[],pageInfo:{startCursor:s?.pageInfo.startCursor??null,endCursor:s?.pageInfo.endCursor??null,hasPreviousPage:!!s?.pageInfo.hasPreviousPage,hasNextPage:!!s?.pageInfo.hasNextPage}}},b=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.CountChatsDocument,variables:{filter:{type:l.ChatType.Support,hasDealProblem:D(a?.dealHasProblem),hasFrozenBalance:!1,isVip:D(a?.ownerIsVip),status:[l.ChatStatus.New]}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}});return{count:Number(r?.data?.countChats??0)}},_=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.ChatsDocument,variables:{pagination:a?.pagination,filter:{type:l.ChatType.Pm,status:[l.ChatStatus.New]},hasSupportAccess:!0},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),s=r?.data?.chats;return{items:s?.edges.map(({node:e})=>{let t,a,r;return t=e.lastMessage?(({deal:e,text:t,user:a})=>{if(!t||!e)return null;let r=R(t),s=null,i=null;return r===c.DealEvent.ItemPaid&&e.item.sellerType===l.ItemSellerType.System&&(r=c.DealEvent.OfficialItemPaid),A.includes(r)&&(s=a??e.user,i=e.item.user),E.includes(r)&&(s=a??e.item.user,i=e.user),{dealEvent:r,eventByUser:s?O(s):null,eventToUser:i?O(i):null}})(e.lastMessage):null,a=null,r=null,e.lastMessage?.event&&(a=e.lastMessage.eventByUser?{id:String(e.lastMessage.eventByUser.id),username:e.lastMessage.eventByUser.username}:null,r=e.lastMessage.eventToUser?{id:String(e.lastMessage.eventToUser.id),username:e.lastMessage.eventToUser.username}:null),t?.dealEvent&&(a=t.eventByUser,r=t.eventToUser),{id:String(e.id),lastMessage:{id:String(e.lastMessage?.id),text:e.lastMessage?.text??null,createdAt:e.lastMessage?.createdAt,event:e.lastMessage?.event??void 0,dealEvent:t?.dealEvent,eventByUser:a,eventToUser:r},unreadMessagesCount:e.unreadMessagesCounter,type:e.type,participants:e.participants?.map(e=>({id:e.id,role:e.role,username:e.username,avatarUrl:e.avatarURL??null,isOnline:e.isOnline,isVip:e.isVip,isBlocked:e.isBlocked,isOfficial:e.role===l.UserRole.OfficialSeller,createdAt:e.createdAt}))}})??[],pageInfo:{startCursor:s?.pageInfo.startCursor??null,endCursor:s?.pageInfo.endCursor??null,hasPreviousPage:!!s?.pageInfo.hasPreviousPage,hasNextPage:!!s?.pageInfo.hasNextPage}}},N=async(e,t)=>{let a=await t.query({query:l.CountChatsDocument,variables:{filter:{type:l.ChatType.Pm,status:[l.ChatStatus.New]}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}});return{count:Number(a?.data?.countChats??0)}},U=async(e,t,a)=>{let r,s=await t.query({query:l.SupportChatDocument,variables:{id:a?.id},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}});return{id:(r=s?.data?.chat).id,status:r.status,type:r.type,owner:{id:r.owner?.id,username:r.owner?.username,avatarUrl:r.owner?.avatarURL??null,isOnline:r.owner?.isOnline,isVip:r.owner?.isVip,isBlocked:r.owner?.isBlocked,isOfficial:r.owner?.role===l.UserRole.OfficialSeller},deals:r.deals?.map(e=>({id:e.id,status:e.status,hasProblem:e.hasProblem,item:{id:e.item?.id,attachmentUrl:e.item?.attachment?.url??null}})),agent:r.agent?{id:r.agent?.id,username:r.agent?.username}:void 0,startedAt:r.startedAt??null,finishedAt:r.finishedAt??null,isTextingAllowed:r.isTextingAllowed,unreadMessagesCount:r.unreadMessagesCounter}},M=async(e,t)=>{let a=[{key:"supportChatRequestsCount",query:t.query({query:l.CountChatsDocument,variables:{filter:{type:l.ChatType.Support,hasDealProblem:!1,hasFrozenBalance:!1,isVip:!1,status:[l.ChatStatus.New]}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),extractCount:e=>e.countChats},{key:"vipSupportChatRequestsCount",query:t.query({query:l.CountChatsDocument,variables:{filter:{type:l.ChatType.Support,hasDealProblem:!1,hasFrozenBalance:!1,isVip:!0,status:[l.ChatStatus.New]}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),extractCount:e=>e.countChats},{key:"suspiciousChatRequestsCount",query:t.query({query:l.CountChatsDocument,variables:{filter:{type:l.ChatType.Pm,status:[l.ChatStatus.New],isVip:!1}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),extractCount:e=>e.countChats},{key:"problemDealChatRequestsCount",query:t.query({query:l.CountChatsDocument,variables:{filter:{type:l.ChatType.Support,hasDealProblem:!0,hasFrozenBalance:!1,isVip:!1,status:[l.ChatStatus.New]}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),extractCount:e=>e.countChats},{key:"moderationItemsCount",query:t.query({query:l.CountItemsDocument,variables:{filter:{status:[l.ItemStatus.PendingApproval,l.ItemStatus.PendingModeration],autoModerationMode:!1}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),extractCount:e=>e.countItems},{key:"moderationTestimonialsCount",query:t.query({query:l.CountTestimonialsDocument,variables:{filter:{status:[l.TestimonialStatus.PendingApproval]}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!1}}),extractCount:e=>e.countTestimonials},{key:"suspiciousSellersCount",query:t.query({query:l.CountUsersDocument,variables:{filter:{isVerified:!1}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!1}}),extractCount:e=>e.countUsers},{key:"gameProposalsCount",query:t.query({query:l.CountGameProposalsDocument}),extractCount:e=>e.countGameProposals},{key:"payoutsCount",query:t.query({query:l.CountTransactionsDocument,variables:{filter:{operation:[l.TransactionOperation.Withdraw],status:[l.TransactionStatus.Pending,l.TransactionStatus.Processing]}}}),extractCount:e=>e.countTransactions},{key:"suspiciousTransactionsCount",query:t.query({query:l.CountTransactionsDocument,variables:{filter:{isSuspicious:!0,operation:[l.TransactionOperation.Buy,l.TransactionOperation.ItemOfficialBuy,l.TransactionOperation.Deposit,l.TransactionOperation.ItemCustomPriority,l.TransactionOperation.ItemDefaultPriority,l.TransactionOperation.ItemPremiumPriority],providerId:[l.TransactionProviderId.BankCardRu,l.TransactionProviderId.BankCard,l.TransactionProviderId.Sbp]}}}),extractCount:e=>e.countTransactions}],r=Object.fromEntries((await Promise.allSettled(a.map(({query:e})=>e))).map((e,t)=>{let r=a[t],s=0;return"fulfilled"===e.status&&e.value.data&&(s=Number(r.extractCount(e.value.data)??0)),[r.key,s]})),s=[{label:"Поддержка",type:c.RequestType.SupportChats,count:r.supportChatRequestsCount},{label:"VIP поддержка",type:c.RequestType.VipSupportChats,count:r.vipSupportChatRequestsCount},{label:"Чаты",type:c.RequestType.SuspiciousChats,count:r.suspiciousChatRequestsCount},{label:"Товары",type:c.RequestType.ModerationItems,count:r.moderationItemsCount},{label:"Сделки",type:c.RequestType.ProblemDealChats,count:r.problemDealChatRequestsCount},{label:"Отзывы",type:c.RequestType.ModerationTestimonials,count:r.moderationTestimonialsCount},{label:"Выплаты",type:c.RequestType.Payouts,count:r.payoutsCount},{label:"Оплаты",type:c.RequestType.Payments,count:r.suspiciousTransactionsCount},{label:"Продавцы",type:c.RequestType.SuspiciousSellers,count:r.suspiciousSellersCount},{label:"Игры",type:c.RequestType.GameProposals,count:r.gameProposalsCount}],i=s.reduce((e,t)=>e+t.count,0);return{items:s,totalCount:i}},q=e=>{switch(e){case!0:return c.PayoutSuspiciousStatus.Suspicious;case!1:return c.PayoutSuspiciousStatus.Verified;case null:return c.PayoutSuspiciousStatus.NotSuspicious}},x=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.TransactionsDocument,variables:{filter:{operation:[l.TransactionOperation.Withdraw],status:a?.statuses,paymentGateway:a?.paymentGateways,isSuspicious:a?.suspicious?(e=>{switch(e){case c.PayoutSuspiciousStatus.Suspicious:return!0;case c.PayoutSuspiciousStatus.Verified:return!1;case c.PayoutSuspiciousStatus.NotSuspicious:return null}})(a?.suspicious):void 0},pagination:a?.pagination,hasSupportAccess:!0,sort:a?.sort},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!1}});return{items:r?.data?.transactions?.edges.map(({node:e})=>({id:String(e.id),status:e.status,paymentGateway:e.props?.paymentGateway,value:e.value,suspicious:q(e.isSuspicious??null),statusDescription:e.statusDescription??null,spbBankName:e.spbBankName??null,verifiedAt:e.verifiedAt??null,verifiedBy:e.verifiedBy?{id:String(e.verifiedBy.id),username:String(e.verifiedBy.username)}:null,completedAt:e.completedAt??null,props:{exchangeRate:e.props?.exchangeRate,amountAfterConversionRub:e.props?.amountAfterConversionRub,amountAfterConversionUsdt:e.props?.amountAfterConversionUsdt,fee:e.props?.fee,paymentAccount:e.props?.paymentAccount,paymentGateway:e.props?.paymentGateway},createdAt:e.createdAt,provider:{id:e.provider.id,name:e.provider.name,minFeeAmount:e.provider.minFeeAmount},user:{id:String(e.user.id),username:String(e.user.username),slug:String(e.user.username).replaceAll(" ","-"),avatarUrl:e.user.avatarURL?String(e.user.avatarURL):"",testimonialsCount:e.user.testimonialCounter,isVip:e.user.isVip??!1,isBlocked:e.user.isBlocked??!1,isOfficial:e.user.role===l.UserRole.OfficialSeller}}))??[],pageInfo:r?.data?.transactions?.pageInfo??{hasNextPage:!1,hasPreviousPage:!1,startCursor:"",endCursor:""}}},L=e=>({id:String(e.id),status:e.status,paymentGateway:e.props?.paymentGateway,value:e.value,suspicious:q(e.isSuspicious??null),statusDescription:e.statusDescription??null,spbBankName:e.spbBankName??null,verifiedAt:e.verifiedAt??null,verifiedBy:e.verifiedBy?{username:e.verifiedBy?.username??void 0}:null,completedAt:e.completedAt??null,props:{exchangeRate:e.props?.exchangeRate,amountAfterConversionRub:e.props?.amountAfterConversionRub,amountAfterConversionUsdt:e.props?.amountAfterConversionUsdt,fee:e.props?.fee,paymentAccount:e.props?.paymentAccount,paymentGateway:e.props?.paymentGateway},createdAt:e.createdAt,provider:{id:e.provider.id,name:e.provider.name,minFeeAmount:e.provider.minFeeAmount},user:{id:String(e.user.id),username:String(e.user.username),slug:String(e.user.username).replaceAll(" ","-"),avatarUrl:e.user.avatarURL?String(e.user.avatarURL):"",testimonialsCount:e.user.testimonialCounter,isVip:!1,isBlocked:e.user.isBlocked??!1,isOfficial:e.user.role===l.UserRole.OfficialSeller}}),k=async(e,t,a)=>{let{status:r,statusDescription:s}=await (0,f.extractBody)(e);return t.mutate({mutation:l.UpdateTransactionDocument,variables:{input:{id:a?.id,status:r,statusDescription:s}},refetchQueries:[l.TransactionsDocument,l.CountTransactionsDocument],errorPolicy:"all",fetchPolicy:"network-only"}).then(e=>{if(e?.errors||!e?.data?.updateTransaction)throw(0,u.createError)("Update payout status failed");return L(e.data.updateTransaction)})},B=async(e,t,a)=>t.mutate({mutation:l.UpdateTransactionDocument,variables:{input:{id:a?.id,...a??{},isSuspicious:!1}},errorPolicy:"all",fetchPolicy:"network-only",refetchQueries:[l.TransactionsDocument,l.CountTransactionsDocument],optimisticResponse(e){let{input:{id:t}}=e;return{updateTransaction:{id:t,isSuspicious:!1,__typename:"Transaction"}}}}).then(e=>{if(e?.errors||!e?.data?.updateTransaction)throw(0,u.createError)("Verify suspicious payout request failed");return L(e.data.updateTransaction)}),V=async(e,t,a)=>{let r=a?.id;return t.mutate({mutation:l.RemoveTransactionDocument,variables:{id:r},refetchQueries:[l.TransactionsDocument,l.CountTransactionsDocument],errorPolicy:"all",fetchPolicy:"network-only"}).then(e=>{if(e?.errors||!e?.data?.removeTransaction)throw(0,u.createError)("Remove payout request failed");return{}})};var G=e.i(533879);let F=e=>({id:String(e.id),username:String(e.username),role:e.role,slug:String(e.username).replaceAll(" ","-"),avatarUrl:String(e.avatarURL),testimonialsCount:e.testimonialCounter,isBlocked:e.isBlocked,isVip:e.isVip??!1,isOfficial:e.role===l.UserRole.OfficialSeller}),Q=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.TransactionsDocument,variables:{pagination:a?.pagination,filter:{isSuspicious:!0,operation:[l.TransactionOperation.Buy,l.TransactionOperation.ItemOfficialBuy,l.TransactionOperation.Deposit,l.TransactionOperation.ItemCustomPriority,l.TransactionOperation.ItemDefaultPriority,l.TransactionOperation.ItemPremiumPriority],providerId:[l.TransactionProviderId.BankCardRu,l.TransactionProviderId.BankCard,l.TransactionProviderId.Sbp]},hasSupportAccess:!0},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),s=r?.data?.transactions;return{items:s?.edges.map(({node:e})=>({id:String(e.id),value:e.value,createdAt:e.createdAt,operation:e.operation,direction:e.direction,providerId:e.providerId,status:e.status,statusDescription:e.statusDescription,user:F(e.user),verifiedBy:e.verifiedBy?F(e.verifiedBy):void 0,props:(e=>{if(e)return{paymentGateway:e.paymentGateway?e.paymentGateway:void 0,paidFromPendingIncome:!!e.paidFromPendingIncome}})(e.props),autoProcessed:!1}))??[],pageInfo:{startCursor:s?.pageInfo.startCursor??null,endCursor:s?.pageInfo.endCursor??null,hasPreviousPage:!!s?.pageInfo.hasPreviousPage,hasNextPage:!!s?.pageInfo.hasNextPage}}},Y=async(e,t,a)=>{try{let e=await t.mutate({mutation:l.UpdateTransactionDocument,variables:{input:{id:a?.id,isSuspicious:!1}},errorPolicy:"all",fetchPolicy:"network-only"});if(e.errors&&e.errors.length>0){let t=new G.ApolloError({graphQLErrors:e.errors,networkError:null});throw(0,u.createError)(t.message,t)}return}catch(e){if(e instanceof G.ApolloError)throw(0,u.createError)(e.message,e);return}},H=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.UserListDocument,variables:{pagination:a?.pagination,filter:{isVerified:!1}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),s=r?.data?.users;return{items:s?.edges.map(({node:e})=>({id:String(e.id),username:String(e.username),avatarUrl:String(e.profile.avatarURL),isBlocked:e.isBlocked,isVip:e.isVip??!1,isOfficial:e.role===c.UserRole.OfficialSeller}))??[],pageInfo:{startCursor:s?.pageInfo.startCursor??null,endCursor:s?.pageInfo.endCursor??null,hasPreviousPage:!!s?.pageInfo.hasPreviousPage,hasNextPage:!!s?.pageInfo.hasNextPage}}},j=async(e,t)=>{let a=(0,u.parseVariables)(e),r=await t.query({query:l.GameProposalsDocument,variables:{pagination:a?.pagination},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),s=await t.query({query:l.CategoriesDocument,variables:{pagination:{first:24}},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),i=r?.data?.gameProposals;return{items:i?.edges.map(({node:e})=>(({gameProposal:e,categories:t})=>{let a=t.map(e=>({id:String(e.id),name:String(e.name)})).reduce((e,t)=>(Object.keys(e).includes(t.id)||(e[t.id]=t),e),{});return{id:String(e.id),name:String(e.name),categories:e.categoryIds.map(e=>a[e]),creator:{id:String(e.creator.id),username:String(e.creator.username),slug:String(e.creator.username).replaceAll(" ","-"),avatarUrl:String(e.creator.avatarURL)}}})({gameProposal:e,categories:s.data?.categories.edges.map(({node:e})=>e)??[]}))??[],pageInfo:{startCursor:i?.pageInfo.startCursor??null,endCursor:i?.pageInfo.endCursor??null,hasPreviousPage:!!i?.pageInfo.hasPreviousPage,hasNextPage:!!i?.pageInfo.hasNextPage}}},X=async(e,t)=>{let a=(0,u.parseVariables)(e);return await t.mutate({mutation:l.RemoveGameProposalsDocument,variables:{ids:a?.ids},errorPolicy:"all",fetchPolicy:"network-only",context:{enableOperationPersistedQueries:!0}}),null},K=async(e,t)=>{let{paymentGateway:a,transactionId:r}=await (0,f.extractBody)(e);return t.mutate({mutation:l.CreateRemoteWithdrawalRequestDocument,variables:{input:{transactionId:r,paymentGateway:a}}}).then(e=>{if(e?.errors||!e?.data?.createRemoteWithdrawalRequest)throw(0,u.createError)("Create remote withdrawal request failed");return{}})},z={"/viewer":{get:o.getViewer,patch:o.patchViewer},"/requests/counts":{get:M},"/items/moderation":{get:m},"/items/moderation/count":{get:y},"/games/search":{get:g},"/games/counters":{get:P},"/testimonials":{get:C},"/testimonials/moderation/count":{get:T},"/testimonials/{id}":{patch:h},"/categories":{get:I},"/chats/support-requests":{get:w},"/chats/support/{id}":{get:U},"/chats/support-requests/count":{get:b},"/chats/suspicious-requests":{get:_},"/chats/suspicious-requests/count":{get:N},"/payouts/requests":{get:x},"/payouts/request/{id}":{patch:k,delete:V},"/transactions/suspicious":{get:Q},"/transactions/suspicious/{id}/verify":{patch:Y},"/sellers/suspicious":{get:H},"/games/proposals":{get:j},"/games/proposals/remove":{delete:X},"/payouts/request/verify-suspicious/{id}":{patch:B},"/withdrawal/request":{post:K}},W=(0,r.createApiContext)(),J=W.useApi,Z=W.useFetchClient;e.s(["AdminApiProvider",0,({children:e,dehydratedState:r})=>{let o=(0,s.useApolloFetchAdapterFn)(z,n.ADMIN_API_BASE_URL),u=(0,i.useStaticInitialize)(()=>((e={})=>(0,a.default)({baseUrl:n.ADMIN_API_BASE_URL,...e,credentials:"include"}))({fetch:o}));return(0,t.jsx)(W.Provider,{fetchClient:u,dehydratedState:r,children:e})},"useAdminApi",0,J,"useAdminFetchClient",0,Z],614266)},547406,e=>{"use strict";let t;var a=e.i(391398),r=e.i(191788),s=e.i(614266);let i=e=>{let{params:t={}}=e??{},{data:a,...r}=(0,s.useAdminApi)().useQuery("get","/viewer",{params:t});return{viewer:a??null,...r}};class n{role=null;constructor(e){this.role=e??null,this.is=this.is.bind(this),this.setRole=this.setRole.bind(this)}is(...e){return!!this.role&&0!==e.length&&e.includes(this.role)}setRole(e){this.role=e}}let o={createPermission:e=>({check:e,__params:{}}),__ctx:{}},{Provider:u,PermissionGuard:l,usePermissionSegment:c}=(t=(0,r.createContext)({ctx:null,status:{isPending:!1,isSuccess:!1,isError:!1}}),{Provider:function({children:e,ctx:r,fetchCtx:s,status:i}){return(0,a.jsx)(t.Provider,{value:{ctx:r,fetchCtx:s,status:i},children:e})},PermissionGuard:function({permission:e,params:a,children:s,fallbackRender:i,pendingRender:n,onDeny:o}){let u=(0,r.useContext)(t),l=(0,r.useRef)(!1);if(!u)throw Error("Permissions context not provided");let{ctx:c,status:{isPending:p}}=u,d=!!(c&&e.check(c,a)),m=(0,r.useEffectEvent)(()=>{l.current||(o?.(),l.current=!0)});return((0,r.useEffect)(()=>{p||d||m()},[p,d]),p)?n??null:d?s:i??null},usePermissionSegment:function(e){let a=(0,r.useContext)(t);if(!a)throw Error("Permissions context not provided");let{ctx:s,status:i,fetchCtx:n}=a;return[Object.entries(e).reduce((e,[t,a])=>(e[t]=e=>a.check(s,e),e[t+"Async"]=async e=>{let t=await n?.()??s;return a.check(t??s,e)},e),{}),i]}}),p=o.createPermission;e.s(["AdminPermissionGuard",0,l,"AdminPermissionsProvider",0,({children:e})=>{let t,{isPending:l,isSuccess:c,isError:p}=i(),d=(()=>{let{viewer:e}=i(),[t,a]=(0,r.useState)(new n);return e?.role&&e.role!==t.role&&a(new n(e.role)),t})(),m=(t=(0,s.useAdminFetchClient)(),(0,r.useCallback)(async()=>{let{data:e}=await t.GET("/viewer");return new n(e?.role)},[t]));return(0,a.jsx)(u,{scope:o,ctx:{role:d},status:{isPending:l,isSuccess:c,isError:p},fetchCtx:async()=>({role:await m()}),children:e})},"createAdminPermission",0,p],547406)}]);